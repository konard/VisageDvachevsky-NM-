# ะะธะทะฐะนะฝ ัะฐะทั 5: ะกะธััะตะผะฐ Play-In-Editor

## ะะฑะทะพั

ะคะฐะทะฐ 5 ัะตะฐะปะธะทัะตั ัะธััะตะผั Play-In-Editor (PIE), ะฟะพะทะฒะพะปััััั ัะฐะทัะฐะฑะพััะธะบะฐะผ ะฟัะตะดะฒะฐัะธัะตะปัะฝะพ ะฟัะพัะผะฐััะธะฒะฐัั ะธ ะพัะปะฐะถะธะฒะฐัั ะฒะธะทัะฐะปัะฝัะต ะฝะพะฒะตะปะปั ะฝะตะฟะพััะตะดััะฒะตะฝะฝะพ ะฒ ัะตะดะฐะบัะพัะต. ะญัะฐ ัะฐะทะฐ ะธะฝัะตะณัะธััะตั ะดะฒะธะถะพะบ ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั NovelMind ั Qt GUI, ะพะฑะตัะฟะตัะธะฒะฐั ะฒะพะทะผะพะถะฝะพััะธ ะพัะปะฐะดะบะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ.

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   Qt GUI Layer                           โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ   โ
โ  โ Play Toolbar โ  โ Debug Overlayโ  โ  StoryGraph  โ   โ
โ  โ  (PIE Panel) โ  โ    Panel     โ  โ  (w/ BPs)    โ   โ
โ  โโโโโโโโฌโโโโโโโโ  โโโโโโโโฌโโโโโโโโ  โโโโโโโโฌโโโโโโโโ   โ
โ         โ                 โ                  โ           โ
โโโโโโโโโโโดโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโค
โ               Play-In-Editor Controller                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  NMPlayModeController (Singleton)                  โ  โ
โ  โ  - playMode: Stopped / Playing / Paused           โ  โ
โ  โ  - runtimeThread: Separate thread for engine      โ  โ
โ  โ  - breakpointMgr: Manages breakpoints             โ  โ
โ  โ  - variableWatch: Live variable inspection        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ               NovelMind Runtime Engine                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  - Scene Manager                                   โ  โ
โ  โ  - Script VM (IR executor)                        โ  โ
โ  โ  - Asset Loader (VFS)                             โ  โ
โ  โ  - Animation System                               โ  โ
โ  โ  - Audio Manager                                  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะะพะผะฟะพะฝะตะฝัั

### 1. NMPlayModeController

**ะัะฒะตัััะฒะตะฝะฝะพััั**: ะฆะตะฝััะฐะปัะฝัะน ะบะพะพัะดะธะฝะฐัะพั ัะตะถะธะผะฐ Play-In-Editor

**ะะปััะตะฒัะต ะผะตัะพะดั:**
```cpp
class NMPlayModeController : public QObject {
    Q_OBJECT
public:
    enum PlayMode { Stopped, Playing, Paused };

    static NMPlayModeController& instance();

    // ะฃะฟัะฐะฒะปะตะฝะธะต ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธะตะผ
    void play();
    void pause();
    void stop();
    void stepForward();  // ะัะฟะพะปะฝะธัั ะพะดะฝั ะธะฝััััะบัะธั

    // ะะฐะฟัะพัั ัะพััะพัะฝะธั
    PlayMode playMode() const;
    bool isPlaying() const;
    bool isPaused() const;

    // ะฃะฟัะฐะฒะปะตะฝะธะต ัะพัะบะฐะผะธ ะพััะฐะฝะพะฒะฐ
    void toggleBreakpoint(const QString& nodeId);
    bool hasBreakpoint(const QString& nodeId) const;
    void clearAllBreakpoints();

    // ะะฝัะฟะตะบัะธั ะฟะตัะตะผะตะฝะฝัั
    QVariantMap getCurrentVariables() const;
    void setVariable(const QString& name, const QVariant& value);

signals:
    void playModeChanged(PlayMode mode);
    void breakpointHit(const QString& nodeId);
    void variablesChanged(const QVariantMap& variables);
    void currentNodeChanged(const QString& nodeId);

private:
    PlayMode m_playMode = Stopped;
    QSet<QString> m_breakpoints;
    QString m_currentNodeId;
    QVariantMap m_variables;

    // ะะฝัะตะณัะฐัะธั ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั (ะฑัะดะตั ัะตะฐะปะธะทะพะฒะฐะฝะพ)
    // std::unique_ptr<RuntimeBridge> m_runtime;
};
```

### 2. ะะฐะฝะตะปั NMPlayToolbar

**ะัะฒะตัััะฒะตะฝะฝะพััั**: ะญะปะตะผะตะฝัั ัะฟัะฐะฒะปะตะฝะธั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธะตะผ ะฝะฐ ะณะปะฐะฒะฝะพะน ะฟะฐะฝะตะปะธ ะธะฝััััะผะตะฝัะพะฒ

**ะะพะทะผะพะถะฝะพััะธ:**
- ะะฝะพะฟะบะฐ Play (โถ๏ธ) - ะะฐัะฐัั ะฒัะฟะพะปะฝะตะฝะธะต
- ะะฝะพะฟะบะฐ Pause (โธ๏ธ) - ะะฐัะทะฐ ะฝะฐ ัะปะตะดัััะตะน ะธะฝััััะบัะธะธ
- ะะฝะพะฟะบะฐ Stop (โน๏ธ) - ะะฐะฒะตััะธัั ะธ ัะฑัะพัะธัั
- ะะฝะพะฟะบะฐ Step Forward (โญ๏ธ) - ะัะฟะพะปะฝะธัั ะพะดะฝั ะธะฝััััะบัะธั
- ะะฝะดะธะบะฐัะพั ัะตะถะธะผะฐ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั (ะผะตัะบะฐ ัะพััะพัะฝะธั)
- ะกัะตััะธะบ ะบะฐะดัะพะฒ / ะพัะพะฑัะฐะถะตะฝะธะต ะฒัะตะผะตะฝะธ

**ะะฐะบะตั UI:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [โถ๏ธ Play] [โธ๏ธ Pause] [โน๏ธ Stop] [โญ๏ธ Step] โ Stopped โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 3. ะะฐะฝะตะปั NMDebugOverlay

**ะัะฒะตัััะฒะตะฝะฝะพััั**: ะะฝัะฟะตะบัะธั ะฟะตัะตะผะตะฝะฝัั ะธ ัะพััะพัะฝะธั ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั

**ะะพะทะผะพะถะฝะพััะธ:**
- **ะะบะปะฐะดะบะฐ Variables**: ะะธะฒัะต ะฟะตัะตะผะตะฝะฝัะต VM ั ัะตะดะฐะบัะธััะตะผัะผะธ ะทะฝะฐัะตะฝะธัะผะธ
- **ะะบะปะฐะดะบะฐ Call Stack**: ะขะตะบััะธะน ััะตะบ ะฒัะฟะพะปะฝะตะฝะธั
- **ะะบะปะฐะดะบะฐ Animation**: ะะบัะธะฒะฝัะต ะฐะฝะธะผะฐัะธะธ ั ะฟะพะปะพัะฐะผะธ ะฟัะพะณัะตััะฐ
- **ะะบะปะฐะดะบะฐ Audio**: ะะพัะฟัะพะธะทะฒะพะดะธะผัะต ะฐัะดะธะพ-ะบะฐะฝะฐะปั ั ะธะฝะดะธะบะฐัะพัะฐะผะธ ะณัะพะผะบะพััะธ
- **ะะบะปะฐะดะบะฐ Performance**: ะัะตะผั ะบะฐะดัะฐ, ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ

**ะะฐะบะตั UI (ะฒะบะปะฐะดะบะฐ Variables):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Variables                         ๐    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ Global Variables                     โ
โ   โโ playerName: "Alice"          [โ๏ธ] โ
โ   โโ affection: 75                [โ๏ธ] โ
โ   โโ chapter: 3                   [โ๏ธ] โ
โ ๐ Local Variables                      โ
โ   โโ tempChoice: "Option A"       [โ๏ธ] โ
โ   โโ loopCounter: 5               [โ๏ธ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Call Stack                              โ
โ   โโ scene_001::dialogue_loop    (42)  โ
โ   โโ main::start                  (15)  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Active Animations (2)                   โ
โ   โโ character_fade โโโโโโโโโ 65%      โ
โ   โโ bg_transition  โโโโโโโโโ 95%      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 4. ะะฝัะตะณัะฐัะธั ัะธััะตะผั ัะพัะตะบ ะพััะฐะฝะพะฒะฐ

**ะัะฒะตัััะฒะตะฝะฝะพััั**: ะัะธะพััะฐะฝะพะฒะบะฐ ะฒัะฟะพะปะฝะตะฝะธั ะฝะฐ ะพะฟัะตะดะตะปะตะฝะฝัั ัะทะปะฐั ะณัะฐัะฐ

**ะะตะฐะปะธะทะฐัะธั:**
- ะะธะทัะฐะปัะฝัะน ะธะฝะดะธะบะฐัะพั ัะพัะบะธ ะพััะฐะฝะพะฒะฐ ะฝะฐ ะฟะฐะฝะตะปะธ StoryGraph (ะบัะฐัะฝะฐั ัะพัะบะฐ ๐ด)
- ะะปะธะบ ะฝะฐ ะฟะพะปะต ะดะปั ะฟะตัะตะบะปััะตะฝะธั ัะพัะตะบ ะพััะฐะฝะพะฒะฐ
- ะขะพัะบะธ ะพััะฐะฝะพะฒะฐ ัะพััะฐะฝััััั ะฒ ะฝะฐัััะพะนะบะฐั ะฟัะพะตะบัะฐ
- ะะพะฟะฐะดะฐะฝะธะต ะฝะฐ ัะพัะบั ะพััะฐะฝะพะฒะฐ ะฒัะทัะฒะฐะตั ัะธะณะฝะฐะป `breakpointHit()`
- ะขะตะบััะธะน ัะทะตะป ะฟะพะดัะฒะตัะธะฒะฐะตััั ะถะตะปัะพะน ะณัะฐะฝะธัะตะน

**ะะฝัะตะณัะฐัะธั StoryGraph:**
```cpp
class NMStoryGraphPanel : public NMDockPanel {
    // ... ัััะตััะฒัััะธะน ะบะพะด ...

protected:
    void paintEvent(QPaintEvent* event) override;
    void mousePressEvent(QMouseEvent* event) override;

private:
    void drawBreakpointGutter(QPainter& painter);
    void handleBreakpointClick(const QPoint& pos);

    QSet<QString> m_nodeBreakpoints;  // ะกะธะฝััะพะฝะธะทะธัะพะฒะฐะฝะพ ั ะบะพะฝััะพะปะปะตัะพะผ
    QString m_currentExecutingNode;    // ะะพะดัะฒะตัะธะฒะฐะตััั ะฒะพ ะฒัะตะผั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั
};
```

### 5. ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพัะพะบะพะผ ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั

**ะัะฒะตัััะฒะตะฝะฝะพััั**: ะะฐะฟััะบ ะดะฒะธะถะบะฐ ะฒ ะพัะดะตะปัะฝะพะผ ะฟะพัะพะบะต, ััะพะฑั ะธะทะฑะตะถะฐัั ะฑะปะพะบะธัะพะฒะบะธ UI

**ะะธะทะฐะนะฝ:**
```cpp
class RuntimeWorker : public QObject {
    Q_OBJECT
public:
    RuntimeWorker();

public slots:
    void startRuntime(const QString& projectPath);
    void pauseRuntime();
    void stopRuntime();
    void stepInstruction();

signals:
    void runtimeStarted();
    void runtimePaused(const QString& nodeId);
    void runtimeStopped();
    void variableUpdate(const QVariantMap& vars);
    void nodeExecuted(const QString& nodeId);

private:
    // void executeInstructionLoop();
    // std::unique_ptr<ScriptVM> m_vm;
};

// ะ NMPlayModeController:
void NMPlayModeController::play() {
    if (!m_workerThread) {
        m_workerThread = new QThread(this);
        m_worker = new RuntimeWorker;
        m_worker->moveToThread(m_workerThread);

        connect(m_worker, &RuntimeWorker::runtimePaused,
                this, &NMPlayModeController::onRuntimePaused);
        // ... ะฑะพะปััะต ะฟะพะดะบะปััะตะฝะธะน

        m_workerThread->start();
    }

    emit startRuntime(currentProjectPath());
    m_playMode = Playing;
    emit playModeChanged(Playing);
}
```

## ะะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ

### ะจะฐะณ 1: ะคัะฝะดะฐะผะตะฝั ะบะพะฝััะพะปะปะตัะฐ
- ะะตะฐะปะธะทะพะฒะฐัั ัะธะฝะณะปัะพะฝ `NMPlayModeController`
- ะะพะฑะฐะฒะธัั ะบะพะฝะตัะฝัะน ะฐะฒัะพะผะฐั play/pause/stop
- ะัะฟัะฐะฒะปััั ัะธะณะฝะฐะปั ะพะฑ ะธะทะผะตะฝะตะฝะธัั ัะพััะพัะฝะธั
- ะะพะฑะฐะฒะธัั ะฝะฐ ะฟะฐะฝะตะปั ะธะฝััััะผะตะฝัะพะฒ ะณะปะฐะฒะฝะพะณะพ ะพะบะฝะฐ

### ะจะฐะณ 2: ะะฐะฝะตะปั Play Toolbar
- ะกะพะทะดะฐัั `NMPlayToolbarPanel` ั ะบะฝะพะฟะบะฐะผะธ
- ะะพะดะบะปััะธัั ะบะฝะพะฟะบะธ ะบ ะผะตัะพะดะฐะผ ะบะพะฝััะพะปะปะตัะฐ
- ะะฑะฝะพะฒะปััั ัะพััะพัะฝะธั ะบะฝะพะฟะพะบ ะฝะฐ ะพัะฝะพะฒะต ัะตะถะธะผะฐ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั
- ะะพะฑะฐะฒะธัั ะณะพัััะธะต ะบะปะฐะฒะธัะธ (F5 = Play, Shift+F5 = Stop)

### ะจะฐะณ 3: ะกะธััะตะผะฐ ัะพัะตะบ ะพััะฐะฝะพะฒะฐ
- ะะพะฑะฐะฒะธัั ะฟะตัะตะบะปััะตะฝะธะต ัะพัะบะธ ะพััะฐะฝะพะฒะฐ ะฒ `NMStoryGraphPanel`
- ะะธะทัะฐะปัะฝัะต ะธะฝะดะธะบะฐัะพัั ัะพัะตะบ ะพััะฐะฝะพะฒะฐ (ะบัะฐัะฝะฐั ัะพัะบะฐ)
- ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั ัะพัะบะธ ะพััะฐะฝะพะฒะฐ ั ะบะพะฝััะพะปะปะตัะพะผ
- ะกะพััะฐะฝััั ัะพัะบะธ ะพััะฐะฝะพะฒะฐ ะฒ ะฝะฐัััะพะนะบะฐั ะฟัะพะตะบัะฐ

### ะจะฐะณ 4: ะะฐะฝะตะปั Debug Overlay
- ะกะพะทะดะฐัั `NMDebugOverlayPanel` ั ะฒะบะปะฐะดะบะฐะผะธ
- ะัะตะฒะพะฒะธะดะฝะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะฟะตัะตะผะตะฝะฝัั ั ะฒะพะทะผะพะถะฝะพัััั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั
- ะะพะดะบะปััะธัั ะบ ัะธะณะฝะฐะปะฐะผ ะฟะตัะตะผะตะฝะฝัั ะบะพะฝััะพะปะปะตัะฐ
- ะะพะฑะฐะฒะธัั ะบะฝะพะฟะบั ะพะฑะฝะพะฒะปะตะฝะธั ะธ ะพะฟัะธั ะฐะฒัะพะพะฑะฝะพะฒะปะตะฝะธั

### ะจะฐะณ 5: ะะฝัะตะณัะฐัะธั ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั (ะฟะพะบะฐ ะทะฐะณะปััะบะฐ)
- ะกะพะทะดะฐัั ะธะฝัะตััะตะนั ะผะพััะฐ ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั
- ะะตะฐะปะธะทะพะฒะฐัั ะผะฐะบะตั VM ะดะปั ัะตััะธัะพะฒะฐะฝะธั
- ะะพะฑะฐะฒะธัั ัะฟัะฐะฒะปะตะฝะธะต ะฟะพัะพะบะฐะผะธ ะดะปั ะฝะตะฑะปะพะบะธััััะตะณะพ ะฒัะฟะพะปะฝะตะฝะธั
- ะะพะดะบะปััะธัั ัะพะฑััะธั ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั ะบ ัะธะณะฝะฐะปะฐะผ ะบะพะฝััะพะปะปะตัะฐ

### ะจะฐะณ 6: ะะพะดัะฒะตัะบะฐ ัะตะบััะตะณะพ ัะทะปะฐ
- ะะพะดัะฒะตัะธัั ัะตะบััะธะน ัะทะตะป ะฒ StoryGraph ะฒะพ ะฒัะตะผั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั
- ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะบัััะบะฐ ะบ ะฐะบัะธะฒะฝะพะผั ัะทะปั
- ะะพะบะฐะทะฐัั ะฟััั ะฒัะฟะพะปะฝะตะฝะธั ั ะทะฐัะตะฝะตะฝะฝัะผะธ ะปะธะฝะธัะผะธ ัะพะตะดะธะฝะตะฝะธั
- ะกะธะฝััะพะฝะธะทะฐัะธั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั ะฒัะตะผะตะฝะฝะพะน ัะบะฐะปั (ะตัะปะธ ะฟัะธะผะตะฝะธะผะพ)

## ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ัะฐะฑะพัะธะต ะฟัะพัะตััั

### ะะฐะฑะพัะธะน ะฟัะพัะตัั 1: ะะฐะทะพะฒะพะต ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธะต
1. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั ะบะฝะพะฟะบั "Play" (ะธะปะธ ะฝะฐะถะธะผะฐะตั F5)
2. ะะพะฝััะพะปะปะตั ะฟะตัะตัะพะดะธั ะฒ ัะตะถะธะผ Playing
3. ะกัะตะดะฐ ะฒัะฟะพะปะฝะตะฝะธั ะฝะฐัะธะฝะฐะตั ะฒัะฟะพะปะฝะตะฝะธะต ั ะฒัะพะดะฝะพะณะพ ัะทะปะฐ
4. ะขะตะบััะธะน ัะทะตะป ะฟะพะดัะฒะตัะธะฒะฐะตััั ะฒ StoryGraph
5. ะะตัะตะผะตะฝะฝัะต ะพะฑะฝะพะฒะปััััั ะฒ Debug Overlay
6. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "Stop" ะดะปั ะทะฐะฒะตััะตะฝะธั

### ะะฐะฑะพัะธะน ะฟัะพัะตัั 2: ะัะปะฐะดะบะฐ ั ัะพัะบะฐะผะธ ะพััะฐะฝะพะฒะฐ
1. ะะพะปัะทะพะฒะฐัะตะปั ัะตะปะบะฐะตั ะฟัะฐะฒะพะน ะบะฝะพะฟะบะพะน ะผััะธ ะฝะฐ ัะทะปะต ะฒ StoryGraph โ "Toggle Breakpoint"
2. ะะพัะฒะปัะตััั ะบัะฐัะฝะฐั ัะพัะบะฐ ะฝะฐ ัะทะปะต
3. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "Play"
4. ะกัะตะดะฐ ะฒัะฟะพะปะฝะตะฝะธั ะฒัะฟะพะปะฝัะตััั ะดะพ ัะทะปะฐ ั ัะพัะบะพะน ะพััะฐะฝะพะฒะฐ
5. ะะพะฝััะพะปะปะตั ะฟะตัะตัะพะดะธั ะฒ ัะตะถะธะผ Paused
6. ะะพะปัะทะพะฒะฐัะตะปั ะฟัะพะฒะตััะตั ะฟะตัะตะผะตะฝะฝัะต ะฒ Debug Overlay
7. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "Step Forward" ะดะปั ะฟะพัะฐะณะพะฒะพะณะพ ะฟัะพะดะพะปะถะตะฝะธั

### ะะฐะฑะพัะธะน ะฟัะพัะตัั 3: ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะถะธะฒัั ะฟะตัะตะผะตะฝะฝัั
1. ะกัะตะดะฐ ะฒัะฟะพะปะฝะตะฝะธั ะฟัะธะพััะฐะฝะพะฒะปะตะฝะฐ ะฝะฐ ัะพัะบะต ะพััะฐะฝะพะฒะฐ
2. ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั Debug Overlay โ ะฒะบะปะฐะดะบะฐ Variables
3. ะะพะปัะทะพะฒะฐัะตะปั ะดะฒะฐะถะดั ัะตะปะบะฐะตั ะฝะฐ ะทะฝะฐัะตะฝะธะธ ะฟะตัะตะผะตะฝะฝะพะน โ ะดะธะฐะปะพะณ ัะตะดะฐะบัะธัะพะฒะฐะฝะธั
4. ะะพะปัะทะพะฒะฐัะตะปั ะผะตะฝัะตั "affection" ั 50 ะฝะฐ 100
5. ะะพะฝััะพะปะปะตั ะฟัะธะผะตะฝัะตั ะธะทะผะตะฝะตะฝะธะต ะบ ััะตะดะต ะฒัะฟะพะปะฝะตะฝะธั
6. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "Play" ะดะปั ะฟัะพะดะพะปะถะตะฝะธั ั ะฝะพะฒัะผ ะทะฝะฐัะตะฝะธะตะผ

## ะะพัะพะบ ัะพะฑััะธะน

```
ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั โ ะะพะฝััะพะปะปะตั โ ะกัะตะดะฐ ะฒัะฟะพะปะฝะตะฝะธั โ ะะพะฝััะพะปะปะตั โ ะะฑะฝะพะฒะปะตะฝะธะต UI

ะัะธะผะตั: ะะปะธะบ ะฝะฐ ะบะฝะพะฟะบั Play
โโ ะะพะปัะทะพะฒะฐัะตะปั: ะะปะธะบ ะฝะฐ ะบะฝะพะฟะบั Play
โโ NMPlayToolbarPanel: emit playClicked()
โโ NMPlayModeController: play()
โ  โโ ะะฐะฟััะบ ะฟะพัะพะบะฐ RuntimeWorker
โ  โโ m_playMode = Playing
โ  โโ emit playModeChanged(Playing)
โโ RuntimeWorker: executeInstructionLoop()
โ  โโ VM ะฒัะฟะพะปะฝัะตั ะธะฝััััะบัะธะธ ัะทะปะฐ
โ  โโ emit nodeExecuted(nodeId)
โ  โโ emit variableUpdate(vars)
โโ NMPlayModeController: ะะพะปััะตะฝะธะต ัะธะณะฝะฐะปะพะฒ
โ  โโ ะะฑะฝะพะฒะปะตะฝะธะต m_currentNodeId
โ  โโ ะะฑะฝะพะฒะปะตะฝะธะต m_variables
โ  โโ emit currentNodeChanged(nodeId)
โ  โโ emit variablesChanged(vars)
โโ ะะฐะฝะตะปะธ UI: ะะฑะฝะพะฒะปะตะฝะธะต ะฒะธะทัะฐะปะธะทะฐัะธะธ
   โโ NMStoryGraphPanel: ะะพะดัะฒะตัะบะฐ ัะตะบััะตะณะพ ัะทะปะฐ
   โโ NMDebugOverlayPanel: ะะฑะฝะพะฒะปะตะฝะธะต ะดะตัะตะฒะฐ ะฟะตัะตะผะตะฝะฝัั
   โโ NMPlayToolbarPanel: ะะฑะฝะพะฒะปะตะฝะธะต ะผะตัะบะธ ัะพััะพัะฝะธั
```

## ะะฝัะตะณัะฐัะธั ั ัััะตััะฒัััะธะผะธ ัะธััะตะผะฐะผะธ

### ะะฝัะตะณัะฐัะธั ั ัะธะฝะพะน ัะพะฑััะธะน
```cpp
// ะัะฑะปะธะบะฐัะธั ัะพะฑััะธะน ะธะท ะบะพะฝััะพะปะปะตัะฐ
QtEventBus::instance().publish(PlayModeChangedEvent{m_playMode});
QtEventBus::instance().publish(BreakpointHitEvent{nodeId});

// ะะฐะฝะตะปะธ ะฟะพะดะฟะธััะฒะฐัััั ะฝะฐ ัะพะฑััะธั
QtEventBus::instance().subscribe<PlayModeChangedEvent>([this](const auto& e) {
    updatePlayModeUI(e.playMode);
});
```

### ะะฝัะตะณัะฐัะธั ั ะพัะผะตะฝะพะน/ะฟะพะฒัะพัะพะผ
- ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฟะตัะตะผะตะฝะฝัั ะฒะพ ะฒัะตะผั ัะตะถะธะผะฐ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั ะะ ะฟัะพัะพะดะธั ัะตัะตะท ะพัะผะตะฝั/ะฟะพะฒัะพั
- ะขะพะปัะบะพ ะธะทะผะตะฝะตะฝะธั ะฝะฐ ััะพะฒะฝะต ะฟัะพะตะบัะฐ (ะดะพะฑะฐะฒะปะตะฝะธะต ัะพัะตะบ ะพััะฐะฝะพะฒะฐ) ะผะพะถะฝะพ ะพัะผะตะฝะธัั
- ะะตะถะธะผ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั - ััะพ ะพัะดะตะปัะฝะพะต "ัะพััะพัะฝะธะต ะพัะปะฐะดะบะธ", ะฝะต ัะฐััั ัะพััะพัะฝะธั ะฟัะพะตะบัะฐ

### ะะฝัะตะณัะฐัะธั ั ัะธััะตะผะพะน ะฒัะฑะพัะฐ
- ะขะตะบััะธะน ะฒัะฟะพะปะฝัะตะผัะน ัะทะตะป ะะ ัะฐััะผะฐััะธะฒะฐะตััั ะบะฐะบ "ะฒัะฑัะฐะฝะฝัะน"
- ะัะดะตะปัะฝัะน ะฒะธะทัะฐะปัะฝัะน ะธะฝะดะธะบะฐัะพั (ะถะตะปัะฐั ะณัะฐะฝะธัะฐ vs ัะธะฝะธะน ะฒัะฑะพั)
- ะะพะปัะทะพะฒะฐัะตะปั ะฒัะต ะตัะต ะผะพะถะตั ะฒัะฑะธัะฐัั ะดััะณะธะต ัะทะปั ะฒะพ ะฒัะตะผั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั

## ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
editor/
โโโ include/NovelMind/editor/qt/
โ   โโโ nm_play_mode_controller.hpp      # ะะะะซะ
โ   โโโ nm_breakpoint_manager.hpp        # ะะะะซะ
โ   โโโ panels/
โ       โโโ nm_play_toolbar_panel.hpp    # ะะะะซะ
โ       โโโ nm_debug_overlay_panel.hpp   # ะะะะซะ
โโโ src/qt/
โ   โโโ nm_play_mode_controller.cpp      # ะะะะซะ
โ   โโโ nm_breakpoint_manager.cpp        # ะะะะซะ
โ   โโโ panels/
โ       โโโ nm_play_toolbar_panel.cpp    # ะะะะซะ
โ       โโโ nm_debug_overlay_panel.cpp   # ะะะะซะ
```

## ะกััะฐัะตะณะธั ัะตััะธัะพะฒะฐะฝะธั

### ะะพะดัะปัะฝัะต ัะตััั
- ะะตัะตัะพะดั ัะพััะพัะฝะธะน ะบะพะฝััะพะปะปะตัะฐ (Stopped โ Playing โ Paused โ Stopped)
- ะะพะฑะฐะฒะปะตะฝะธะต/ัะดะฐะปะตะฝะธะต/ะฟะตัะตะบะปััะตะฝะธะต ัะพัะบะธ ะพััะฐะฝะพะฒะฐ
- ะะฟะตัะฐัะธะธ ะฟะพะปััะตะฝะธั/ัััะฐะฝะพะฒะบะธ ะฟะตัะตะผะตะฝะฝัั

### ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
- ะกะพะตะดะธะฝะตะฝะธั ัะธะณะฝะฐะป/ัะปะพั
- ะะฝะพะณะพะฟะพัะพัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั
- ะะฑะฝะพะฒะปะตะฝะธั UI ะฟัะธ ะธะทะผะตะฝะตะฝะธัั ัะพััะพัะฝะธั

### ะััะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต
- ะัะทัะฒัะธะฒะพััั ะณะพัััะธั ะบะปะฐะฒะธั
- ะะธะทัะฐะปัะฝัะต ะธะฝะดะธะบะฐัะพัั ัะพัะตะบ ะพััะฐะฝะพะฒะฐ
- ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฟะตัะตะผะตะฝะฝัั ะฒะพ ะฒัะตะผั ะฟะฐัะทั
- ะะตะทะพะฟะฐัะฝะพััั ะฟะพัะพะบะพะฒ (ะฑะตะท ะทะฐะฒะธัะฐะฝะธั UI)

## ะัะธัะตัะธะธ ะทะฐะฒะตััะตะฝะธั ัะฐะทั 5

- [ ] `NMPlayModeController` ัะตะฐะปะธะทะพะฒะฐะฝ ั ะบะพะฝะตัะฝัะผ ะฐะฒัะพะผะฐัะพะผ
- [ ] ะะฐะฝะตะปั ะธะฝััััะผะตะฝัะพะฒ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั ั ะบะฝะพะฟะบะฐะผะธ Play/Pause/Stop/Step
- [ ] ะกะธััะตะผะฐ ัะพัะตะบ ะพััะฐะฝะพะฒะฐ ะฝะฐ ะฟะฐะฝะตะปะธ StoryGraph
- [ ] ะะฐะฝะตะปั Debug Overlay ั ะดะตัะตะฒะพะผ ะฟะตัะตะผะตะฝะฝัั
- [ ] ะะพะดัะฒะตัะบะฐ ัะตะบััะตะณะพ ัะทะปะฐ ะฒะพ ะฒัะตะผั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั
- [ ] ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพัะพะบะพะผ ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั (ะทะฐะณะปััะบะฐ ัะตะฐะปะธะทะฐัะธะธ)
- [ ] ะะพัััะฐั ะบะปะฐะฒะธัะฐ F5 ะดะปั Play
- [ ] ะัะต ัะธะณะฝะฐะปั/ัะปะพัั ะฟะพะดะบะปััะตะฝั
- [ ] ะะตั ะฑะปะพะบะธัะพะฒะบะธ UI ะฒะพ ะฒัะตะผั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั
- [ ] ะขะพัะบะธ ะพััะฐะฝะพะฒะฐ ัะพััะฐะฝััััั ะฒ ะฝะฐัััะพะนะบะฐั ะฟัะพะตะบัะฐ
- [ ] CI ะฟัะพัะพะดะธั ะฝะฐ ะฒัะตั ะฟะปะฐััะพัะผะฐั

## ะัะดััะธะต ัะปัััะตะฝะธั (ะฟะพัะปะต ัะฐะทั 5)

- **ะัะพะดะฒะธะฝััะฐั ะพัะปะฐะดะบะฐ**: ะฃัะปะพะฒะฝัะต ัะพัะบะธ ะพััะฐะฝะพะฒะฐ, ะฒััะฐะถะตะฝะธั ะพััะปะตะถะธะฒะฐะฝะธั
- **ะัะพัะธะปะธัะพะฒะฐะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ**: ะัะฟะพะปัะทะพะฒะฐะฝะธะต CPU/ะฟะฐะผััะธ ะฝะฐ ัะทะตะป
- **ะะพัััะฐั ะฟะตัะตะทะฐะณััะทะบะฐ**: ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ัะบัะธะฟัะพะฒ ะฒะพ ะฒัะตะผั ัะตะถะธะผะฐ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั
- **ะะฐะฟะธัั**: ะะฐะฟะธัั ะฟัะพัะพะถะดะตะฝะธั ะดะปั ัะตััะธัะพะฒะฐะฝะธั
- **ะกะตัะตะฒะฐั ะพัะปะฐะดะบะฐ**: ะะฝัะฟะตะบัะธั ัะพััะพัะฝะธั ัะตัะตะฒะพะน ะฒะธะทัะฐะปัะฝะพะน ะฝะพะฒะตะปะปั
- **ะะพะฝัะพะปั ัะบัะธะฟัะธะฝะณะฐ**: ะัะฟะพะปะฝะตะฝะธะต ะฟัะพะธะทะฒะพะปัะฝัั ะบะพะผะฐะฝะด ะฒะพ ะฒัะตะผั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั

## ะัะธะผะตัะฐะฝะธั

**ะะฝัะตะณัะฐัะธั ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั**: ะะปั ัะฐะทั 5.0 ะผั ัะตะฐะปะธะทัะตะผ **ะผะฐะบะตั ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั**, ะบะพัะพััะน ัะธะผัะปะธััะตั ะฒัะฟะพะปะฝะตะฝะธะต ัะทะปะพะฒ ะฑะตะท ะฟะพะปะฝะพะน ะธะฝัะตะณัะฐัะธะธ ะดะฒะธะถะบะฐ. ะญัะพ ะฟะพะทะฒะพะปัะตั ะฝะฐะผ ะฟัะพะฒะตัะธัั ะฐััะธัะตะบัััั GUI ะฟะตัะตะด ัะปะพะถะฝะพะน ะธะฝัะตะณัะฐัะธะตะน ะดะฒะธะถะบะฐ.

**ะะพะฒะตะดะตะฝะธะต ะผะฐะบะตัะฐ ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั**:
- ะะพัะฐะณะพะฒะพะต ะฟัะพัะพะถะดะตะฝะธะต ะดะตะผะพ-ัะทะปะพะฒ StoryGraph ัะพ ัะบะพัะพัััั 1 ัะทะตะป/ัะตะบัะฝะดั
- ะะตะฝะตัะฐัะธั ะฟะพะดะดะตะปัะฝัั ะฟะตัะตะผะตะฝะฝัั (playerName, affection, chapter)
- ะกะพะฑะปัะดะตะฝะธะต ัะพัะตะบ ะพััะฐะฝะพะฒะฐ (ะฟะฐัะทะฐ ะฟัะธ ะฟะพะฟะฐะดะฐะฝะธะธ)
- ะะพัะพะบะพะฑะตะทะพะฟะฐัะฝะฐั ัะฒัะทั ั GUI

**ะะตะฐะปัะฝะฐั ะธะฝัะตะณัะฐัะธั ััะตะดั ะฒัะฟะพะปะฝะตะฝะธั** (ะคะฐะทะฐ 5.1+):
- ะะฐะผะตะฝะฐ ะผะฐะบะตัะฐ ะฝะฐ ะฝะฐััะพััะธะน ScriptVM
- ะะฝัะตะณัะฐัะธั ะพััะธัะพะฒะบะธ ััะตะฝั ะฒ SceneView
- ะะพะดะบะปััะตะฝะธะต ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั Timeline
- ะะพะปะฝะฐั ัะธััะตะผะฐ ะฐัะดะธะพ/ะฐะฝะธะผะฐัะธะธ

---

**ะกัะฐััั**: ะะพัะพะฒะพ ะบ ัะตะฐะปะธะทะฐัะธะธ
**ะะฐะฒะธัะธะผะพััะธ**: ะะตั (ัััะพะธััั ะฝะฐ ัะฐะทะฐั 0-4)
**ะัะตะฝะพัะฝะฐั ัะปะพะถะฝะพััั**: ะกัะตะดะฝะต-ะฒััะพะบะฐั
**ะัะธะพัะธัะตั**: ะะซะกะะะะ - ะัะฝะพะฒะฝะฐั ััะฝะบัะธะพะฝะฐะปัะฝะพััั ัะตะดะฐะบัะพัะฐ
